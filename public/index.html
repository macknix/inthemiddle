<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meet in the Middle - Interactive Map</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div class="header">
        <h1>🗺️ Meet in the Middle</h1>
        <p>Interactive map with heat zones and travel routes</p>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <div id="status" class="status-indicator"></div>
            
            <form id="searchForm">
                <div class="input-group">
                    <label for="address1">📍 First Address <span id="locationStatus" style="font-size: 12px; color: #666;"></span></label>
                    <input type="text" id="address1" placeholder="Detecting your location..." required>
                </div>
                
                <div class="input-group">
                    <label for="address2">📍 Second Address</label>
                    <input type="text" id="address2" placeholder="Start typing for suggestions..." required>
                </div>
                
                <button type="submit" class="search-btn" id="searchBtn">
                    🚇 Find Meeting Point
                </button>
            </form>
            
            <div class="business-filters" id="businessFilters" style="display: none;">
                <h4>🏪 Business Filters</h4>
                <div class="filter-group">
                    <label class="filter-checkbox">
                        <input type="checkbox" value="restaurant" checked> 🍽️ Restaurants
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="cafe" checked> ☕ Cafes
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="bar" checked> 🍺 Bars
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="shopping_mall" checked> 🛍️ Shopping
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="store" checked> 🏪 Stores
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="park" checked> 🌳 Parks
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="tourist_attraction" checked> 🎯 Attractions
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="gym" checked> 💪 Gyms
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="library" checked> 📚 Libraries
                    </label>
                </div>
                <button class="filter-apply-btn" onclick="applyFilters()">Apply Filters</button>
                <div class="business-count" style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
                    No businesses displayed
                </div>
            </div>
            
            <div id="loading" class="loading" style="display: none;">
                🔍 Finding optimal meeting point and calculating routes...
            </div>
            
            <div id="results"></div>
        </div>
        
        <div class="map-container">
            <div class="maps-container single-map" id="mapsContainer">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="scripts/main.js?v=11"></script>
    
    <!-- Load Google Maps API dynamically with key from backend -->
    <script>
        // Load Google Maps API with key from backend
        fetch('http://localhost:5001/api/config')
            .then(response => response.json())
            .then(config => {
                if (config.success && config.data.googleMapsApiKey) {
                    const script = document.createElement('script');
                    script.async = true;
                    script.defer = true;
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${config.data.googleMapsApiKey}&libraries=geometry,places&callback=initMaps`;
                    script.onerror = () => {
                        console.error('Failed to load Google Maps API');
                        document.body.innerHTML += '<div style="position: fixed; top: 10px; right: 10px; background: #f44336; color: white; padding: 10px; border-radius: 4px;">❌ Google Maps API failed to load</div>';
                    };
                    document.head.appendChild(script);
                } else {
                    console.error('Google Maps API key not available');
                    document.body.innerHTML += '<div style="position: fixed; top: 10px; right: 10px; background: #ff9800; color: white; padding: 10px; border-radius: 4px;">⚠️ Google Maps API key not configured</div>';
                }
            })
            .catch(error => {
                console.error('Failed to get configuration:', error);
                document.body.innerHTML += '<div style="position: fixed; top: 10px; right: 10px; background: #f44336; color: white; padding: 10px; border-radius: 4px;">❌ Failed to connect to API server</div>';
            });
    </script>
</body>
</html>
